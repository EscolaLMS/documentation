import{_ as s,o as a,c as n,V as l}from"./chunks/framework.c495fe11.js";const d=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"development/cra.md","filePath":"development/cra.md"}'),p={name:"development/cra.md"},o=l(`<h2 id="setting-up-your-own-domain" tabindex="-1">Setting up your own domain <a class="header-anchor" href="#setting-up-your-own-domain" aria-label="Permalink to &quot;Setting up your own domain&quot;">​</a></h2><ol><li>Setup domains in <a href="https://caddyserver.com/docs/caddyfile" target="_blank" rel="noreferrer">Caddyfile</a>, then restart caddy <code>docker-compose restart proxy</code>. Example:</li></ol><p>Before</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">http://admin.wellms.localhost</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#FFCB6B;">reverse_proxy</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">admin:80</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">http://app.wellms.localhost</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#FFCB6B;">reverse_proxy</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">app:80</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">http://api.wellms.localhost</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#FFCB6B;">reverse_proxy</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">api:80</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">http://mailhog.wellms.localhost</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#FFCB6B;">reverse_proxy</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mailhog:8025</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre></div><p>After</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">admin.escolalms.com</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#FFCB6B;">reverse_proxy</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">admin:80</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">demo.escolalms.com</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#FFCB6B;">reverse_proxy</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">app:80</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">api.escolalms.com</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#FFCB6B;">reverse_proxy</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">api:80</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">mailhog.escolalms.com</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#FFCB6B;">reverse_proxy</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mailhog:8025</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre></div><p><strong>NOTE</strong> Settings above will automatically create you SSL Lets Encrypt Certification.</p><ol start="2"><li>Change <code>API_URL</code> in <code>docker-compose.yml</code>, and restart dockers with <code>make restart</code>.</li></ol><p>Before</p><div class="language-yml"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">environment</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">API_URL=http://api.wellms.localhost</span></span></code></pre></div><p>After</p><div class="language-yml"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">environment</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">API_URL=https://api.escolalms.com</span></span></code></pre></div><ol start="3"><li>Edit <code>APP_URL</code> in <code>.env</code> file</li></ol><div class="language-yml"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C3E88D;">APP_URL=http://api.wellms.localhost/</span></span></code></pre></div><p>After</p><div class="language-yml"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C3E88D;">APP_URL=https://api.escolalms.com/</span></span></code></pre></div><ol start="4"><li>Clear Laravel Cache, enter bash by calling <code>make bash</code> then call artisan commands <code>optimize:clear</code> and <code>responsecache:clear</code></li></ol><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">Create-LMS-App</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">git:</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">main</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">make</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">bash</span></span>
<span class="line"><span style="color:#FFCB6B;">docker-compose</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">exec</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-u</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1000</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">api</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">bash</span></span>
<span class="line"><span style="color:#FFCB6B;">devilbox@0d6a75afa279:/var/www/html$</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">php</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">artisan</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">optimize:clear</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">Cached</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">events</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cleared!</span></span>
<span class="line"><span style="color:#FFCB6B;">Compiled</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">views</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cleared!</span></span>
<span class="line"><span style="color:#FFCB6B;">Application</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cache</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cleared!</span></span>
<span class="line"><span style="color:#FFCB6B;">Route</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cache</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cleared!</span></span>
<span class="line"><span style="color:#FFCB6B;">Configuration</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cache</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cleared!</span></span>
<span class="line"><span style="color:#FFCB6B;">Compiled</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">services</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">and</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">packages</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">files</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">removed!</span></span>
<span class="line"><span style="color:#FFCB6B;">Caches</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cleared</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">successfully!</span></span>
<span class="line"><span style="color:#FFCB6B;">devilbox@0d6a75afa279:/var/www/html$</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">php</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">artisan</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">responsecache:clear</span></span>
<span class="line"><span style="color:#FFCB6B;">Response</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cache</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cleared!</span></span></code></pre></div><h2 id="scaling-php-fpm-horizon-scheduler" tabindex="-1">Scaling php-fpm, Horizon &amp; Scheduler. <a class="header-anchor" href="#scaling-php-fpm-horizon-scheduler" aria-label="Permalink to &quot;Scaling php-fpm, Horizon &amp; Scheduler.&quot;">​</a></h2><p>By default all 3 threads phpfpm, Laravels Horizon and Scheduler are severed by one <a href="https://github.com/EscolaLMS/API/blob/develop/Dockerfile" target="_blank" rel="noreferrer">image container</a></p><ul><li><code>php-fpm</code> serve main Laravel REST API (with <a href="https://github.com/EscolaLMS/API/tree/develop/docker/conf/nginx" target="_blank" rel="noreferrer">nginx</a> and <a href="https://github.com/EscolaLMS/Create-LMS-App/blob/main/Caddyfile" target="_blank" rel="noreferrer">caddy</a>)</li><li><a href="https://laravel.com/docs/9.x/horizon" target="_blank" rel="noreferrer"><code>horizon</code></a> is responsible for all <a href="https://laravel.com/docs/9.x/queues" target="_blank" rel="noreferrer">queue services</a></li><li><a href="https://laravel.com/docs/9.x/scheduling" target="_blank" rel="noreferrer"><code>Task Scheduling</code></a> is responsible for all cron jobs</li></ul><p>All of above including nginx are served by <code>supervisor</code>, definition files are <a href="https://github.com/EscolaLMS/API/tree/develop/docker/conf/supervisor" target="_blank" rel="noreferrer">listed here</a></p><p>You can scale this by setting each process into separate image container, just by amending <code>docker-compose.yml</code> in the following way</p><div class="language-yml"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># NOTE binding emptyfile.conf disable supervisor service</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">api</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">escolalms/api:latest</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">networks</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">escola_lms</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">volumes</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./emptyfile.conf:/etc/supervisor/custom.d/horizon.conf</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./emptyfile.conf:/etc/supervisor/custom.d/scheduler.conf</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">#      - ./emptyfile.conf:/etc/supervisor/custom.d/nginx.conf</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./storage:/var/www/html/storage</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./.env:/var/www/html/.env</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">horizon</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">escolalms/api:latest</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">networks</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">escola_lms</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">volumes</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">#     - ./emptyfile.conf:/etc/supervisor/custom.d/horizon.conf</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./emptyfile.conf:/etc/supervisor/custom.d/scheduler.conf</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./emptyfile.conf:/etc/supervisor/custom.d/nginx.conf</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./storage:/var/www/html/storage</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./.env:/var/www/html/.env</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">scheduler</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">escolalms/api:latest</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">networks</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">escola_lms</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">volumes</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./emptyfile.conf:/etc/supervisor/custom.d/horizon.conf</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">#      - ./emptyfile.conf:/etc/supervisor/custom.d/scheduler.conf</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./emptyfile.conf:/etc/supervisor/custom.d/nginx.conf</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./storage:/var/www/html/storage</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./.env:/var/www/html/.env</span></span></code></pre></div>`,24),e=[o];function c(t,r,C,y,i,D){return a(),n("div",null,e)}const m=s(p,[["render",c]]);export{d as __pageData,m as default};
